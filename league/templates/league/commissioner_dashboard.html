{% extends "base.html" %}
{% block content %}

<h1 class="mb-3">Commissioner Dashboard â€“ {{ league.name }} ({{ league.season_year }})</h1>

<div class="row mb-4">

    <!-- LEFT SIDE BUTTONS -->
    <div class="col-md-3">

        <a href="{% url 'commish_settings' league.id %}" class="btn btn-primary w-100 mb-2">
            âš™ï¸ Edit League Settings
        </a>

        <a href="{% url 'scoring_settings' league.id %}" class="btn btn-secondary w-100 mb-2">
            ğŸ“Š Scoring Settings
        </a>

        <a href="{% url 'commish_roster_tools' league.id %}" class="btn btn-info w-100 mb-2">
            âœï¸ Roster Override Tool
        </a>

        <a href="#" class="btn btn-warning w-100 mb-2 disabled">
            ğŸ”„ League Transactions (coming soon)
        </a>

        <a href="#" class="btn btn-success w-100 mb-2 disabled">
            ğŸ’ Draft Center (future)
        </a>

    </div>

    <!-- RIGHT SIDE: TEAM LIST -->
    <div class="col-md-9">
        <div class="card">

            <div class="card-header">
                <h4>League Teams</h4>
            </div>

            <div class="card-body">

                {% if teams %}
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Manager</th>
                            <th>Players</th>
                            <th>Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for team in teams %}
                        <tr>
                            <td>{{ team.name }}</td>
                            <td>
                                {% if team.manager %}
                                    {{ team.manager.username }}
                                {% else %}
                                    <em>No manager</em>
                                {% endif %}
                            </td>
                            <td>{{ team.roster_set.count }}</td>
                            <td>
                                <a href="{% url 'commish_edit_team_roster' league.id team.id %}"
                                   class="btn btn-sm btn-outline-primary">
                                    Manage
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>

                {% else %}
                <p>No teams have been created yet.</p>
                {% endif %}

            </div>
        </div>
    </div>

</div>

<!-- NEW ROW: TRANSACTIONS + TRADES -->
<div class="row">

    <!-- Recent Transactions -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h4>Recent Transactions</h4>
            </div>
            <div class="card-body">
                {% if recent_transactions %}
                    <ul class="list-group">
                        {% for tx in recent_transactions %}
                        <li class="list-group-item">
                            <strong>{{ tx.created_at|date:"Y-m-d H:i" }}</strong><br>

                            {% if tx.team %}
                                <span>Team: {{ tx.team.name }}</span><br>
                            {% endif %}

                            {% if tx.player %}
                                <span>Player: {{ tx.player.full_name }}</span><br>
                            {% endif %}

                            <span>Action: {{ tx.action }}</span>

                            {% if tx.note %}
                                <br><small class="text-muted">{{ tx.note }}</small>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No recent transactions.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Trades -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h4>Recent Trades</h4>
            </div>
            <div class="card-body">
                {% if recent_trades %}
                    <ul class="list-group">
                        {% for trade in recent_trades %}
                        <li class="list-group-item">
                            <strong>{{ trade.created_at|date:"Y-m-d H:i" }}</strong><br>
                            <span>{{ trade.from_team.name }} â†” {{ trade.to_team.name }}</span><br>

                            {% if trade.approved %}
                                <span class="badge bg-success">Approved</span>
                            {% elif trade.vetoed %}
                                <span class="badge bg-danger">Vetoed</span>
                            {% else %}
                                <span class="badge bg-secondary">Pending</span>
                            {% endif %}

                            {% if trade.commissioner_note %}
                                <br><small class="text-muted">{{ trade.commissioner_note }}</small>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No recent trades.</p>
                {% endif %}
            </div>
        </div>
    </div>

</div>

{% endblock %}
